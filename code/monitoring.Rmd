---
title: "Monitoring Progress"
author: "Johannes Brachem"
date: "27.11.2018"
output: html_document
---

# Pakete

```{r}
library(tidyverse)
library(formr)
```


## Installieren
Formr package installieren. Das Formr Package kann nicht über CRAN per `install.packages` installiert werden, sondern muss mit `devtools` von github gezogen werden.

```{r}
# install.packages("devtools")
# devtools::install_github("rubenarslan/formr")
```

Falls andere Pakete noch installiert werden müssen, hier einfach das # entfernen und die Zeile ausführen. Das Paket `lubridate` wird dabei automatisch mitinstalliert, muss unten aber trotzdem separat geladen werden.
```{r}
# install.packages("tidyverse")
```

```{r}
main <- read_csv("data/main_step05.csv")
```



# Descriptives

```{r}
# Number of different unis
main %>% select(uni_current) %>% pull() %>% unique() %>% length()

main$length %>% median()
skimr::skim(main)
```

# Plots
## Plot nach Unis
```{r}
# projects_tbl <- loadRDS("projects.rds")
```

### Ohne Korrektur
```{r}
uni_plot <- main %>%
  ggplot(aes(x = fct_infreq(uni_current)))

uni_plot +
  geom_bar() +
  #geom_bar(fill = c(rep("grey40", 8), "red", rep("grey40",39))) +
  #geom_bar(fill = c(rep("grey40", 9), "red", rep("grey40",39))) +
  labs(x = "Uni", y = "Number of Participants") +
  annotate("text", x = 40, y = 40, label = paste("Gesamt N =", nrow(main))) +
  annotate("text", x = 35, y = 19, label = "Rote Linie: 30 TeilnehmerInnen\n Ab 30 TeilnehmerInnen pro Uni können\nwir die Daten sinnvoll auswerten") +
  geom_hline(yintercept = 30, color = "red") +
  geom_hline(yintercept = 100, color = "green") +
  annotate("text", x = 35, y = 93, label = "Grüne Linie: 100 TeilnehmerInnen") +
  annotate("text", x = 20, y = 45,
           label = sprintf("Teilnahmezahlen Open Science Umfrage\nmethoden.formr.org\nStand: %s", Sys.Date())) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  NULL
```

### Mit Korrektur
Abzug von Teilnehmenden, die noch kein empirisches Projekt durchgeführt haben.

```{r}
main_psystudents <- main %>% 
  filter(field_of_study_mc == "Psychologie" | study_degree_field == 1)

nrow(main) - nrow(main_psystudents)

n_no_empirical_exp <- main_psystudents %>% 
  group_by(uni_current) %>% 
  summarise(n = sum(emp_experience == "Nein"))

n_no_empirical_exp %>% pull(n) %>% sum()

n_vp <- main_psystudents %>% 
  group_by(uni_current) %>% 
  summarise(n = n())

n_vp_corrected <- n_vp %>% 
  mutate(n = n - n_no_empirical_exp$n)

main_psystudents$uni_current %>% unique() %>%   length()
```

```{r}
n_vp_corrected %>% 
  arrange(desc(n)) %>% 
  filter(n > 30) %>% 
  mutate(n = n - 30)
```


```{r}
uni_plot_corrected <- n_vp_corrected %>% 
  ggplot(aes(x = fct_reorder(uni_current, n, .desc = T), y = n))

uni_plot_corrected + 
  geom_bar(stat = "identity") + 
  #geom_bar(fill = c(rep("grey40", 8), "red", rep("grey40",39))) +
  #geom_bar(fill = c(rep("grey40", 9), "red", rep("grey40",39))) +
  labs(x = "Uni", y = "Number of Participants", 
       title = "Teilnehmende mit empirischer Erfahrung",
       subtitle = "Gezählt werden hier: Psychologie-Studierende und Psycholog*innen, die 2017 oder 2018 ihren Abschluss gemacht haben.") +
  annotate("text", x = 40, y = 40, label = paste("Eingeschlossen n =", sum(n_vp_corrected$n), "\n Ausgeschlossen n = ", sum(n_no_empirical_exp$n))) +
  annotate("text", x = 35, y = 19, label = "Rote Linie: 30 TeilnehmerInnen\n Ab 30 TeilnehmerInnen pro Uni können\nwir die Daten sinnvoll auswerten") +
  geom_hline(yintercept = 30, color = "red") +
  geom_hline(yintercept = 100, color = "green") +
  annotate("text", x = 35, y = 93, label = "Grüne Linie: 100 TeilnehmerInnen") +
  annotate("text", x = 20, y = 45, label = sprintf("Teilnahmezahlen Open Science Umfrage\nmethoden.formr.org\nStand: %s", Sys.Date())) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  NULL
```

## Plot nach Zeit
```{r}
qplot(ended, data=main, ylab = "Number of Participants", 
      xlab = "Survey Completion")
```

## Plot nach Semester
```{r}
sems_plot <- main %>% 
  filter(study_stage_mc != "Anderer") %>% 
  filter(semester < 11) %>% 
  mutate(semester = ifelse(semester %% 2 == 0, semester - 1, semester)) %>% 
  mutate(semester = factor(semester, 
                           labels = c("1/2", "3/4", "5/6", "7/8", "9/10"))) %>% 
  group_by(semester, study_stage_mc) %>% 
  summarise(n = n()) %>% 
  
  ggplot(aes(x = factor(semester), y = n))

sems_plot + 
  geom_bar(stat = "identity") +
  facet_wrap(~study_stage_mc) +
  #facet_grid(study_stage_mc~.) +
  labs(x = "Semester", y = "Anzahl", 
       title = "Anzahl Teilnehmende nach Fachsemester und Studienabschnitt") +
  theme_classic()
```


## Erstsemester nach Uni
```{r}
n_bsc1 <- main %>% 
  filter(study_stage_mc == "Bachelor") %>% 
  filter(semester == 1) %>% 
  group_by(uni_current) %>% 
  summarise(n = n())

bsc1_plot <- ggplot(n_bsc1, aes(x = fct_reorder(uni_current, n, .desc=T), y = n))

bsc1_plot + geom_bar(stat = "identity") +
  labs(x = "Uni", y = "Anzahl", 
       title = "Teilnehmende im 1. B.Sc.-Semester nach Uni") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  NULL
```

## VP ohne empirische Erfahrung: Detailansicht
```{r}
main %>% 
  group_by(semester, study_stage_mc) %>% 
  summarise(n_no_exp = sum(emp_experience == "Nein"),
            n_total = n()) %>% 
  mutate(share_have_no_exp = round(n_no_exp / n_total, 2)) %>% 
  mutate(share_of_no_exp = round(n_no_exp/sum(n_no_empirical_exp$n),2))
```





